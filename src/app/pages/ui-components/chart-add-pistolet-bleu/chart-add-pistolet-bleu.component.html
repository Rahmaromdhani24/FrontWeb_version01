<mat-card class="cardWithShadow theme-card">
    <mat-card-header>
      <mat-card-title class="m-b-0" id="titreNumCourant">Numéro Courant : {{numeroCourant}}</mat-card-title>
    </mat-card-header>
    <mat-card-content class="b-t-1">
      <div  *ngIf="donneesMoyenne.length > 0" style="width: 100%; height: 400px;" >
        <ejs-chart 
          [title]="title" 
          [titleStyle]="titleStyle"
          [primaryXAxis]="primaryXAxis" 
          [primaryYAxis]="primaryYAxis"
          [tooltip]="tooltip"
          [annotations]="annotations"
          [legendSettings]="{visible: false}"
          background="transparent">
          <e-series-collection>
            <e-series 
              [dataSource]="seriesMoyenne" 
              type="Line" 
              xName="x" 
              yName="y" 
              width="2"
              [marker]="{
                visible: true, 
                width: 10, 
                height: 10,
                shape: 'Circle',
                dataLabel: { visible: false }
              }"
              [animation]="{ enable: true }">
            </e-series>
          </e-series-collection>
        </ejs-chart>
        <span id="label50"> 50 -</span>
        <span id="label56"> 56 -</span>
        <span id="label65"> 65 -</span>
        <span id="label74"> 74 -</span>
        <span id="label80"> 80 -</span>
      </div>
      <div *ngIf="donneesEtendu.length > 0" style="width: 100%; height: 250px;">
        <ejs-chart 
          [title]="titleEtendue" 
          [titleStyle]="titleStyleEtendue"
          [primaryXAxis]="primaryXAxisEtendue" 
          [primaryYAxis]="primaryYAxisEtendue"
          [tooltip]="tooltipEtendue"
          [annotations]="annotationsEtendue"
          [legendSettings]="{visible: false}">
          <e-series-collection>
            <e-series 
              [dataSource]="seriesEtendue" 
              type="Line" 
              xName="x" 
              yName="y" 
              width="2"
              [marker]="{
                visible: true, 
                width: 10, 
                height: 10,
                shape: 'Circle',
                fill: 'black',
                dataLabel: { visible: false }
              }">
            </e-series>
          </e-series-collection>
        </ejs-chart>
      </div>
      <br> <br>
        <div class="form-container">
          <!-- Première colonne (gauche) -->
          <div class="form-column">
            <mat-label class="f-w-600 m-b-30 d-block">Type de pistolet : &nbsp;
              <span class="labelCoupePropre">Pistolet Vert</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Numéro de pistolet : &nbsp;
              <span class="labelCoupePropre">{{pistolet.ech1}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Coupe Propre : &nbsp;
              <span class="labelCoupePropre">{{pistolet.coupePropre}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Nombre de collier tester : &nbsp;
              <span class="labelCoupePropre">{{pistolet.nbrCollierTester}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Axe de serrage : &nbsp;
              <span class="labelCoupePropre">{{pistolet.axeSerrage}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Semaine : &nbsp;
              <span class="labelCoupePropre">{{pistolet.semaine}}</span>
            </mat-label>
          </div>
      
          <!-- Deuxième colonne -->
          <div class="form-column">
            <mat-label class="f-w-600 m-b-30 d-block">Échantillon 1 : &nbsp;
              <span class="labelCoupePropre">{{pistolet.ech1}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Échantillon 2 : &nbsp;
              <span class="labelCoupePropre">{{pistolet.ech2}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Échantillon 3 : &nbsp;
              <span class="labelCoupePropre">{{pistolet.ech3}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Échantillon 4 : &nbsp;
              <span class="labelCoupePropre">{{pistolet.ech4}}</span>
            </mat-label>
            <mat-label class="f-w-600 m-b-30 d-block">Échantillon 5 : &nbsp;
              <span class="labelCoupePropre">{{pistolet.ech5}}</span>
            </mat-label>
            <mat-label class="grid-label-container">
              <span>Moyenne X̄ : &nbsp;<span class="labelCoupePropre">{{pistolet.moyenne}}</span></span>
              <span class="right-text">Étendue R = &nbsp;<span class="labelCoupePropre">{{pistolet.etendu}}</span></span>
            </mat-label>
          </div>
        </div>
        <div class="actions">
          <button mat-flat-button color="primary" class="m-r-8" id="btnSave" type="button" (click)="naviger()">
            Voir PDEK
          </button>
        
          <!-- ✅ Cas 1 : Pistolet validé => bouton désactivé en rouge -->
          <ng-container *ngIf="valide; else verifierActivation">
            <button mat-flat-button class="bg-danger text-black" disabled>
              PDEK déjà validé
            </button>
          </ng-container>
        
          <!-- ✅ Cas 2 ou 3 : on vérifie activationValider -->
          <ng-template #verifierActivation>
            <ng-container *ngIf="pistolet.activationValider; ">
              <button
                mat-flat-button
                class="bg-success text-white"
                (click)="validerPdekPistolet()"
              >
                Valider PDEK
              </button>
            </ng-container>
          </ng-template>
        
          <!-- ✅ Cas 3 : Pistolet non conforme -->
          <ng-template #templateCreerPlanAction>
            <button mat-flat-button class="bg-warning text-white" (click)="creerPlanAction()">
              Créer Plan d'action
            </button>
          </ng-template>
        </div>
    </mat-card-content>
  </mat-card>