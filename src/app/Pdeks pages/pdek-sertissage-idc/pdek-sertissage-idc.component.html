<div class="loading" *ngIf="showLoader">
    <span id="loader" class="loader"></span>
  </div>

  <div class="pdf-scroll-wrapper" *ngIf="!showLoader">
    <div class="pdf-container" *ngFor="let page of pages ; let pageIndex = index">
      <!-- En-tête -->
    <div class="header">
      <!-- Titre principal -->
      <div class="main-title" style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">
        Carte d'enregistrement des données de processus (PDCC) Spécifique pour IDC Lumberg (Hauteur de fermuture) et Force de traction
      </div>
      <div class="styleLogoLeoni"> LEONI </div>
    </div>
      <!-- Tableau -->
    <div id="idBorderTableau">
    <table border="2" id="tableTitre">
      <tr>
        <td style="font-size: 13px;">Type de l'opération  :
          <br><strong style="color: black;font-size: 18px;">Sertissage IDC </strong>
        </td>
        <td style="font-size: 13px;">Section du fil  :
            <br><strong style="color: black;font-size: 18px;">0.35  mm²</strong>
          </td>
        <td style="font-size: 13px;"> Force de traction :<br>
          <strong style="color: black;font-size: 18px;"> 50 N</strong>
        </td>
        <td style="font-size: 13px;">Hauteur de sertissage <br>
          <strong style="color: red;font-size: 18px;">CH : 11 - 10.85</strong>
        </td>    
        <td style="font-size: 13px;">
          Segment / année<br>
          {{segmentUser}} /  {{ getAnnee(page,0) ?? '' }}        
        </td>
        <td style="font-size: 13px;">
          Page : <br>
          {{ pageIndex + 1 }} / {{ pages.length }}
        </td>
      </tr>
  </table>
   
    </div>
      <div id="idHauteurCote1">
        <span id="text"> Hauteur Sertissage :<br>&nbsp;&nbsp;&nbsp;&nbsp; Coté 1</span>
        <apx-chart 
        [series]="page.chartCote1Hauteur.series"
        [chart]="page.chartCote1Hauteur.chart"
        [xaxis]="page.chartCote1Hauteur.xaxis"
        [yaxis]="page.chartCote1Hauteur.yaxis"
        [stroke]="page.chartCote1Hauteur.stroke"
        [dataLabels]="page.chartCote1Hauteur.dataLabels"
        [markers]="page.chartCote1Hauteur.markers"
        [tooltip]="page.chartCote1Hauteur.tooltip"
        [annotations]="page.chartCote1Hauteur.annotations"
        [fill]="page.chartCote1Hauteur.fill"
        [legend]="page.chartCote1Hauteur.legend"
          style="margin-left: 80px;
                  position: absolute;
                  width: 1171px;
                  margin-top: -40px;" 
        ></apx-chart>
      </div>
      <div id="idHauteurCote1">
        <span id="text"> Hauteur Sertissage :<br> &nbsp;&nbsp;&nbsp;&nbsp;Coté 2</span>
        <apx-chart 
        [series]="page.chartCote1Hauteur.series"
        [chart]="page.chartCote1Hauteur.chart"
        [xaxis]="page.chartCote1Hauteur.xaxis"
        [yaxis]="page.chartCote1Hauteur.yaxis"
        [stroke]="page.chartCote1Hauteur.stroke"
        [dataLabels]="page.chartCote1Hauteur.dataLabels"
        [markers]="page.chartCote1Hauteur.markers"
        [tooltip]="page.chartCote1Hauteur.tooltip"
        [annotations]="page.chartCote1Hauteur.annotations"
        [fill]="page.chartCote1Hauteur.fill"
        [legend]="page.chartCote1Hauteur.legend"
          style="margin-left: 80px;
                  position: absolute;
                  width: 1171px;
                  margin-top: -40px;" 
        ></apx-chart>
      </div>
      <div id="idHauteurCote2">
        <span id="text"> Force de traction :<br>&nbsp;&nbsp;&nbsp;&nbsp;Coté 1</span>
        <apx-chart 
        [series]="page.chartCote1Traction.series"
        [chart]="page.chartCote1Traction.chart"
        [xaxis]="page.chartCote1Traction.xaxis"
        [yaxis]="page.chartCote1Traction.yaxis"
        [stroke]="page.chartCote1Traction.stroke"
        [dataLabels]="page.chartCote1Traction.dataLabels"
        [markers]="page.chartCote1Traction.markers"
        [tooltip]="page.chartCote1Traction.tooltip"
        [annotations]="page.chartCote1Traction.annotations"
        [fill]="page.chartCote1Traction.fill"
        [legend]="page.chartCote1Traction.legend"
          style="margin-left: 80px;
                  position: absolute;
                  width: 1171px;
                  margin-top: -40px;"
        ></apx-chart>
      </div>
    <div id="idHauteurCote2">
        <span id="text"> Force de traction :<br> 
          &nbsp;&nbsp;&nbsp;&nbsp;Coté 2</span>
        <apx-chart 
        [series]="page.chartCote2Traction.series"
        [chart]="page.chartCote2Traction.chart"
        [xaxis]="page.chartCote2Traction.xaxis"
        [yaxis]="page.chartCote2Traction.yaxis"
        [stroke]="page.chartCote2Traction.stroke"
        [dataLabels]="page.chartCote2Traction.dataLabels"
        [markers]="page.chartCote2Traction.markers"
        [tooltip]="page.chartCote2Traction.tooltip"
        [annotations]="page.chartCote2Traction.annotations"
        [fill]="page.chartCote2Traction.fill"
        [legend]="page.chartCote2Traction.legend"
          style="margin-left: 80px;
                  position: absolute;
                  width: 1171px;
                  margin-top: -40px;"
        ></apx-chart>
      </div>
   
      <div class="tables-wrapper" >
       <!-- TABLEAU PRINCIPAL -->
<table class="main-table">
  <thead>
    <tr>
      <th *ngFor="let _ of [].constructor(8)" style="border: none; background: transparent;"></th>
      <ng-container *ngFor="let group of eight; let groupIndex = index">
        <th><span style="margin-left:-7px;">Ech 1</span></th>
        <th><span style="margin-left:-7px;">Ech 2</span></th>
        <th><span style="margin-left:-7px;">Ech 3</span></th>
        <th><span style="margin-left:-7px;">Fin</span></th>
      </ng-container>
    </tr>
  </thead>
  
  
  <tbody>
    <!-- Première ligne : Titre des échantillons -->

  
    <!-- Deuxième ligne : Valeurs de C1 -->
    <tr>
      <th id="gras">C1</th>
      <th colspan="7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hauteur de sertissage (mm)</th>
      <ng-container *ngFor="let group of eight; let col = index">
        <td>{{ getValeurC1(page, 0, col) ?? '' }}</td>
        <td>{{ getValeurC1(page, 1, col) ?? '' }}</td>
        <td>{{ getValeurC1(page, 2, col) ?? '' }}</td>
        <td>{{ getValeurC1(page, 3, col) ?? '' }}</td>
      </ng-container>
    </tr>
  
    <!-- Troisième ligne : Valeurs de C2 (si besoin) -->
    <tr>
      <th id="gras">C2</th>
      <th colspan="7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hauteur de sertissage (mm)</th>
      <ng-container *ngFor="let group of eight; let col = index">
        <td>{{ getValeurC2(page, 0, col) ?? '' }}</td>
        <td>{{ getValeurC2(page, 1, col) ?? '' }}</td>
        <td>{{ getValeurC2(page, 2, col) ?? '' }}</td>
        <td>{{ getValeurC2(page, 3, col) ?? '' }}</td>
      </ng-container>
    </tr>
  
    <tr>
      <th id="gras">C1</th>
      <th colspan="7">&nbsp;Force de traction N</th>
      <ng-container *ngFor="let group of eight; let col = index">
        <td>{{ getTractionC1(page, 0, col) ?? '' }}</td>
        <td>{{ getTractionC1(page, 1, col) ?? '' }}</td>
        <td>{{ getTractionC1(page, 2, col) ?? '' }}</td>
        <td>{{ getTractionC1(page, 3, col) ?? '' }}</td>
      </ng-container>
    </tr>
  
    <!-- Troisième ligne : Valeurs de C2 (si besoin) -->
    <tr>
      <th id="gras">C2</th>
      <th colspan="7">&nbsp;Force de traction N</th>
      <ng-container *ngFor="let group of eight; let col = index">
        <td>{{ getTractionC2(page, 0, col) ?? '' }}</td>
        <td>{{ getTractionC2(page, 1, col) ?? '' }}</td>
        <td>{{ getTractionC2(page, 2, col) ?? '' }}</td>
        <td>{{ getTractionC2(page, 3, col) ?? '' }}</td>
      </ng-container>
    </tr>
 
    
  <tr class="gris-background">
    <th id="gras" colspan="8">N° de Cycle</th>
    <td *ngFor="let i of [].constructor(8); let idx = index" colspan="4" id="gras">
      {{ idx + 1 }}
    </td>
  </tr>

  <tr>
    <th id="gras" colspan="8">Code </th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      {{ getCode(page, col) ?? '' }}
    </td>
  </tr>

  <tr>
    <th  id="gras" colspan="8">Produit </th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      {{ getProduit(page, col) ?? '' }}
    </td>
  </tr>

  <tr>
    <th id="gras" colspan="8">Série Produit</th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      {{ getSerieProduit(page, col) ?? '' }}
    </td>
  </tr>

  <tr>
    <th id="gras" colspan="8">Quantité Cycle</th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      {{ getQuantiteCycle(page, col) ?? '' }}
    </td>
  </tr>

  <tr>
    <th id="gras" colspan="8">N° machine</th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      {{ getNumMachine(page, col) ?? '' }}
    </td>
  </tr>

  <tr>
    <th id="gras" colspan="8">Date </th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      {{ getDate(page, col) ?? '' }}
    </td>
  </tr>
  <tr>
    <th id="gras" colspan="8">Opérateur </th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      <ng-container *ngIf="page.sertissages[col] as sertissage">
          {{ getOperateur(page, col) ?? '' }}
      </ng-container>
    </td>
    
  </tr>
    <tr>
    <th id="gras" colspan="8">Matricule QM </th>
    <td *ngFor="let i of eight; let col = index" colspan="4">
      <ng-container *ngIf="page.sertissages[col] as sertissage">
        <button 
          (click)="onValiderSertissage(sertissage.id)" 
          *ngIf="role==='AGENT_QUALITE'&&
                 sertissage.decision === 0 && sertissage.rempliePlanAction === 0 &&
                 !pistoletsValides.has(sertissage.id)" 
          class="custom-check-button">
          <i class="fa fa-check"></i>
        </button>
        <span *ngIf="sertissage.decision === 1 || pistoletsValides.has(sertissage.id)">
          {{ getQM(page, col) ?? '' }}
        </span>
         <span *ngIf="role ==='AGENT_QUALITE'  
                      &&sertissage.decision === 0 && 
                       sertissage.rempliePlanAction === 1">Invalide</span>
        <span *ngIf="role ==='CHEF_DE_LIGNE' && sertissage.decision === 0">N/V</span>
      </ng-container>
    </td>
    
  </tr>
  </tbody>
</table>
       </div>
       <div>
              <br>
            <span id="titreCode"> Code de Controle : </span>
            <span id="code1"> S = Démarrage du cycle </span>
            <span id="code2"> M = Changement matière  </span>
            <span id="code3"> R = Réparation ou réglage Outil/Machine </span>
            <span id="code4"> L = Fin de commande</span>
            <span id="code5"> A = Discontinuité du au fin matière </span>
            </div>
             </div>

    <button mat-flat-button color="primary" class="m-r-8" type="submit" id="retourBtn" 
    (click)="naviger()">Retour à la liste des PDEKs</button>

    </div>
   